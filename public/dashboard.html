<!DOCTYPE html>
<html lang="fa">
<head><meta charset="UTF-8"><title>داشبورد</title></head>
<body>
  <form id="logoutForm" method="POST" action="/logout">
    <input type="hidden" name="_csrf" id="csrfLogout">
    <button type="submit">خروج</button>
  </form>
  <form id="dataForm">
    <input type="text" id="info" placeholder="اطلاعات جدید" required>
    <button type="submit">ذخیره</button>
    <input type="hidden" id="csrfData">
  </form>
  <ul id="dataList"></ul>
  <script src="script.js"></script>
</body>
</html>
  <script>
    // Fetch CSRF token for logout form
    fetch("/csrf-token", { credentials: "same-origin" })
      .then(r => r.json())
      .then(d => { document.getElementById("csrfLogout").value = d.csrfToken; });

    // Fetch CSRF token for data form
    fetch("/csrf-token", { credentials: "same-origin" })
      .then(r => r.json())
      .then(d => { document.getElementById("csrfData").value = d.csrfToken; });

    // Handle data form submission
    document.getElementById("dataForm").addEventListener("submit", function(e) {
      e.preventDefault();
      const info = document.getElementById("info").value;
      const csrfToken = document.getElementById("csrfData").value;

      fetch("/data", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "CSRF-Token": csrfToken
        },
        body: JSON.stringify({ info }),
        credentials: "same-origin"
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          const li = document.createElement("li");
          li.textContent = info;
          document.getElementById("dataList").appendChild(li);
          document.getElementById("info").value = "";
        } else {
          alert("خطا در ذخیره اطلاعات");
        }
      });
    });
  </script>